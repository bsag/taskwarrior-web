<div class="mb-auto h-max">
    <div id="undo_confirm"></div>
    {% set on_all = "all" %}
    {% set on_complete = "complete" %}
    {% set on_pending = "pending" %}
    {% set on_waiting = "waiting" %}
    {% set mod_key = "" %}
    <div class="pl-2 pr-5 py-1.5 bg-neutral-700 shadow-xl rounded-sm mt-2 text-xs flex flex-wrap ">
        <div class="md:flex-grow sm:row-autotag-list">
            <div class="tag-list">
                <button class="tag-item tag-item-800"
                        hx-get="tasks/undo/report"
                        hx-trigger="click,keyup[{{mod_key}}key=='u'] from:#cmd-inp"
                        hx-target="#undo_confirm"
                        hx-swap="innerHTML">
                    <u>u</u>
                </button>
                <span>
                    <label for="cmd-inp" class="hidden">:</label>
                    <input type="text" id="cmd-inp" class=" pl-1 bg-neutral-400 outline-none" placeholder="commands" autofocus/>
                </span>
            </div>
        </div>
        <div class="md:flex-grow sm:row-autotag-list">
            <div class="tag-list">
                {% for f in current_filter %}
                <button class="tag-item tag-item-800"
                        hx-include="[id='filtering']"
                        hx-get="tasks?query={{ f | replace(from='+', to='%2B') }}"
                        hx-target="#list-of-tasks">
                    {{ f }}
                </button>
                {% endfor %}
            </div>
            <input type="hidden" id="filtering" name="filter_value" value="{{ filter_value }}">
        </div>
        <div class="tag-list">
            <button class="tag-item tag-item-800 {{ on_pending }}" id="pending" hx-get="tasks?status=pending"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='p'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>p</u>ending
            </button>
            <button class="tag-item tag-item-800 {{ on_waiting }}" id="waiting" hx-get="tasks?status=waiting"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='w'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>w</u>aiting
            </button>
            <button class="tag-item tag-item-800  {{ on_complete }}" id="completed" hx-get="tasks?status=completed"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='c'] from:#cmd-inp"
                    hx-target="#list-of-tasks" hx-swap="innerHTML"><u>c</u>ompleted
            </button>
        </div>
        <div class="tag-list">
            <button class="tag-item tag-item-800" id="priority-h" hx-get="tasks?query=priority:H"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='h'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>H</u>
            </button>
            <button class="tag-item tag-item-800" id="priority-m" hx-get="tasks?query=priority:M"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='m'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>M</u>
            </button>
            <button class="tag-item tag-item-800" id="priority-l" hx-get="tasks?query=priority:L"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='l'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>L</u>
            </button>
        </div>
        <div class="tag-list">
            <button class="tag-item tag-item-800" hx-get="tasks?report=all"
                    hx-include="[id='filtering']"
                    hx-target="#list-of-tasks"
                    hx-trigger="click,keyup[{{mod_key}}key=='a'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>a</u>ll
            </button>
            <button class="tag-item tag-item-800" hx-get="tasks?report=next"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='n'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>n</u>ext
            </button>
            <button class="tag-item tag-item-800" hx-get="tasks?report=ready"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='r'] from:#cmd-inp"
                    hx-swap="innerHTML"><u>r</u>eady
            </button>
            <button class="tag-item tag-item-800" hx-get="tasks?report=new"
                    hx-target="#list-of-tasks"
                    hx-include="[id='filtering']"
                    hx-trigger="click,keyup[{{mod_key}}key=='e'] from:#cmd-inp"
                    hx-swap="innerHTML">n<u>e</u>w
            </button>
        </div>
    </div>

    <div class="relative overflow-x-auto shadow-md sm:rounded-lg overflow-y-auto">
        <table id="list-of-tasks" class="table-large">
            <thead class="table-large-header">
            <tr>
                <th>ID</th>
                <th>Age</th>
                <th>Depends</th>
                <th>Project</th>
                <th>Tag</th>
                <th class="min-w-96">Description</th>
                <th>Urg</th>
                <th>ACT</th>
                <th>DUE</th>
                <th>SCH</th>
                <th>END</th>
                <th>Recur</th>
            </tr>
            </thead>
            <tbody class="list-view">
            {% for task in tasks %}
            {% set status_color = on_all %}
            {% if task.status == 'pending' %}
            {% set status_color = on_pending %}
            {% elif task.status == 'complete' %}
            {% set status_color = on_complete %}
            {% elif task.status == 'waiting' %}
            {% set status_color = on_waiting %}
            {% endif %}
            <tr>
                <td>

                    <div class="checkbox-wrapper-32">
                        <input
                                type="checkbox"
                                name="checkbox-{{ task.uuid }}"
                                id="checkbox-{{ task.uuid }}"
                                hx-trigger="change"
                                hx-post="tasks" hx-target="#list-of-tasks"
                                hx-include="[id='filtering']"
                                {% if task.status !="completed" %}
                                hx-vals='{"status": "completed", "uuid":"{{ task.uuid }}"}'
                                hx-swap="innerHTML"
                                {% else %}
                                checked="checked"
                                hx-vals='{"status": "pending", "uuid":"{{ task.uuid }}", "query": "status:completed" }'
                                hx-swap="innerHTML"
                                {% endif %}
                        >
                        <label for="checkbox-{{ task.uuid }}">
                            {{ task.id }}
                        </label>
                        <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <path d="M 10 10 L 90 90" stroke="#000" stroke-dasharray="113"
                                  stroke-dashoffset="113"></path>
                            <path d="M 90 10 L 10 90" stroke="#000" stroke-dasharray="113"
                                  stroke-dashoffset="113"></path>
                        </svg>
                    </div>
                </td>
                <td>{% if task.entry %}{{ date_proper(date=task.entry) }}{% endif %}</td>
                <td>{% if task.depends %}
                    {% for uuid in task.depends %}
                    {%if tasks_db[uuid] %}{{ tasks_db[uuid].id }}{% endif %}
                    {% endfor %}
                    {% endif %}
                </td>
                <td>
                    {% if task.project %}
                    <div class="breadcrumb tag-list">
                        {% for p in task.project | split(pat=".") %}
                        <button class="tag-item tag-item-800"
                                hx-include="[id='filtering']"
                                hx-target="#list-of-tasks"
                                hx-get="tasks?query=project:{{ project_name(full_name=task.project, index=loop.index) }}"
                        >
                            {{ p }}
                        </button>
                        {% endfor %}
                    </div>
                    {% endif %}
                </td>
                <td>
                    <div class="tag-list">
                        {% if task.tags %}
                        {% for p in task.tags %}
                        <button class="tag-item tag-item-800" hx-get="tasks?query=%2B{{ p }}"
                                hx-target="#list-of-tasks"
                                hx-include="[id='filtering']"
                                hx-swap="innerHTML">
                            {{ p }}
                        </button>
                        {% endfor %}
                        {% endif %}
                        {% if task.priority %}
                        <button class="tag-item {{ task.priority }} tag-item-800"
                                hx-get="tasks?query=priority:{{ task.priority }}" hx-target="#list-of-tasks"
                                hx-include="[id='filtering']"
                                hx-swap="innerHTML"
                        >{{ task.priority }}
                        </button>
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div>
                        {% if task.annotations %}
                        <p>
                            <strong>{{ task.description }}</strong>
                        </p>
                        <ul class="pl-4">
                            {% for annotation in task.annotations %}
                            <li>{{ annotation.description }}</li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        {{ task.description }}
                        {% endif %}
                    </div>
                </td>
                <td>{{ task.urgency }}</td>
                <td>
                    {% if task.start %}
                    {{ date_proper(date=task.start) }}
                    {% endif %}
                </td>
                <td>
                    {% if task.due and task.status != 'completed' %}
                    {{ date_proper(date=task.due, in_future=true) }}
                    {% endif %}
                </td>

                <td>
                    {% if task.scheduled %}
                    {{ date_proper(date=task.scheduled, in_future=true) }}
                    {% endif%}
                </td>
                <td>
                    {% if task.end %}{{ date_proper(date=task.end) }}
                    {% else %}
                    &nbsp;
                    {% endif %}
                </td>
                <td>
                    {% if task.recur %}{{task.recur}}{% endif %}
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>